name: CI with Nix Flake

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install Nix
        uses: DeterminateSystems/nix-installer-action@v14
      - name: Run checks and tests in devShell
        run: |
          nix --experimental-features 'nix-command flakes' develop .# --command bash -c "
            bun install
            bun run quality
            bun run test:all
          "
